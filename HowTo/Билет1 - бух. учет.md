# Билет 1 - решение оперативной задачи

**Дисклеймер** Данные записи, по-сути, практическая выжимка решения, теор. часть практически не разбирается! Поэтому важен теоретических базис от любого доступного источника: Курс 1С УЦ, Курс Гилёва, Курс Чистова, практическое пособие разработчика и т.д.

## Краткая справка

---

1. При построении решения обязательно использовать следующие метаданные (за не использование сразу неуд.):
    * План видов характеристик *Виды субконто*
      * Необходим для заведения выявленных в ходе решения аналитик, кроме тех, которые будут измерениями (см. раздел **Анализ билета**)
    * План счетов *Управленческий*
      * Необходим для заведения регистра бухгалтерии к которому привязывается ПВХ *Виды субконто* (подробнее см. теорию)
    * Регистр бухгалтерии
      * строится на основании выявленных аналитик с привязкой и к плану счетов и к видам субконто (подробнее в примере решения)
2. *ВАЖНО!* НЕЛЬЗЯ добавлять и удалять счета учета из плана счетов, только если на это нет указания в задании!
3. Все добавляемые элементы должны быть предопределёнными, чаще всего это касается новых видов субконто
4. Все объекты решения всегда должны быть включены в соответствующую подсистему и разнесены по группам (см. базовые настройки конфигурации...)
    * делается это перед началом тестирования решения
5. Два слова о плане счетов
    * *Признак учёта* - позволяет **включить** учёт по ресурсу для счетов. По умолчанию: **выключен (ЛОЖЬ)**
    * *Признак учёта субконто* - позволяет **выключить** учёт по ресурсу для субконто. По умолчанию: **Включен (Истина)**
    * У субконто есть признак *Только обороты* - это аналог вида регистра накопления: *Выключен* - это остатки, *Включен* - обороты. Это важно для будущих задач

## Анализ билета

---

Выделяем ключевые особенности решения 1-2 словами, чтобы потом по этому чек-листу разрабатывать решение

* Используемые документы: "Приходная накладная", "Расходная накладная"
* Создать документ "Операция"
* Учет в разрезе сроков годности (Дата) / указывается в ТЧ
* Списание при продаже - от мин. срока
* Себестоимость - средняя по товару в целом
* Отчет по кол-ву и сумме в разрезе товаров и сроков годности
  * Сумма расчетная! = [СредняяЦена] * [КоличествоПоСроку]
    * СредняяЦена = [СебестоимостьПоТовару] / [КоличествоТовара]

Полезно выписать проводки на листок, чтобы потом не смотреть в билет:

* Приходная накладная
  * *ДТ "Товары" = КТ "Поставщики" на кол-во и сумму закупа*
  
* Расходная накладная
  * *ДТ "Прибыли и убытки" = КТ "Товары" на кол-во и сумму себестоимости*
  * *ДТ "Покупатели" = КТ "Прибыли и убытки" на кол-во и сумму продажи*

**Проектирование регистра начинается с анализа отчета!**

* В отчете есть аналитики: *Товар* и *Срок годности*: значит  будет минимум 2 субконто: *Номенклатура*, *Срок годности*
  * В других билетах одна из аналитик может быть измерением. Чаще всего: *Организация*

* В отчете есть данные по количеству, а значит должен быть ресурс *Количество*. Настройки этого ресурса одинаковы для всех задач:
  * Заводится признак ведения учета *Количественный*
  * Признак подключается к нужному счету (в нашем случае это счет *Товары*)
  * У ресурса регистра отключить признак *балансовый*

* Как достать количество?
  * Из таблицы остатков *Регистра Бухгалтерии*. Отборы и поля:
    * Счет: *Товары*
    * Субконто: *Номенклатура*, *СрокГодности*
    * берём реквизит *КоличествоОСтаток*

* как достать данные для расчета суммы?
  * Из таблицы остатков *Регистра Бухгалтерии*. Отборы и поля:
    * Счет: *Товары*
    * Субконто: *Товары*
    * Формула: *СуммаОстаток* / *КоличествоОстаток* с проверкой на 0
* Итого: 2 запроса и соединение между ними (в нашем случае *внутреннее* ибо один и тот же счет за один и тот же период)

**ВАЖНО! Актуально для всех задач всех учётов** Подобный анализ требуется делать ВСЕГДА ДО решения билета, а то потом возможны ситуации, когда отчет не собирается!

Дальше анализируем другие условия: есть ли там доп. аналитики или специфические условия, кроме выявленных в отчете? В нашем случае нет, поэтому можно приступать к решению билета

### Подготовка объектов метаданных

---

* В данной задаче НИЧЕГО не сказано про услуги, но про услуги сказано в задаче по ОУ, поэтому и тут нужно фильтровать услуги.

* В табличную часть документов *Приходная накладная* и *Расходная накладная* добавляем новый реквизит *Срок годности*
  * Тип: *Дата* - *Дата*
  * Ставим признак *Проверка заполнения* в *Выдавать ошибку*
  * требуется для *Учет в разрезе сроков годности (Дата) / указывается в ТЧ*

* Настраиваем план видов субконто *Виды субконто*
  * Субконто *Номенклатура* уже есть в каркасной конфигурации
  * Добавляем необходимые типы в настройки ПВХ
    * в нашем случае тип *Дата*-*Дата*
  * Добавляем новый вид субконто в предопределённые - *Срок годности* (*Дата*-*Дата*)
  * Требуется для **всех** ключевых особенностей билета

    ![ПВХ "Виды субконто"](Ticket1/b001.png)

* Настраиваем план счетов *"Управленческий"*
  
  * Вкладка *"Данные"*

    * Добавляем признак учёта *Количественный* - настраиваем признаки учёта по счетам
      * Товары должны списываться по количеству, значит нужен будет ресурс *Количество*
      * Ресурс количество в разрезе задачи важен только для 1 счёт *Товары*, значит нужен признак, позволяющий **включить** учёта по количеству для этого счёта
  
    ![План счетов, вкладка "Данные"](Ticket1/b002_01.png)

  * Вкладка *"Субконто"*

    * Привязываем ПВХ *"Виды субконто"* - настраиваем субконто

    * Выставляем макс. количество субконто
      * в процессе анализа выявлено 2 аналитики
      * Отчет строится только через счёт *Товары* и обе аналитики участвуют в отчете, значит на нём должно быть 2 субконто
      * Других аналитик нет, значит макс. количество субконто = 2

    * Добавляем признак учёта субконто *"Суммовой"*
      * Себестоимость считает по товару в целом, значит показатель суммы для субконто "Срок годности" для нас неважен
      * В отчете сумма - это расчетный показатель, значит для вывода нам сумма не нужна
      * Вывод: на субконто "Срок годности" нет нужны вести суммовой учёт, поэтому требуется признак **отключения** учёта по сумме
  
    ![План счетов, вкладка "Субконто"](Ticket1/b002_02.png)

  * Вкладка *"Прочее"* - *"Предопределенные"* - настраиваем счета
    * Дополнительные настройки нужны ТОЛЬКО для счета товары, поэтому настраиваем только его
    * Включаем признак учета *Количественный*
    * Добавляем 2 субконто: *Товары* и *Срок годности*

    ![План счетов, счет "Товары"](Ticket1/b003.png)

  * Требуется для **всех** ключевых особенностей билета
  
  * Создаём регистр бухгалтерии *"Управленческий**
  
    * Вкладка *"Основные"*
      * Привязываем регистру план счетов *Управленческий*
      * Включаем флаг *Корреспонденция* - этот флаг на экзамен включается всегда

      ![Регистр бухгалтерии, вкладка "Основные"](Ticket1/b004_01.png)

    * вкладка *"Данные"*
      * Измерений нет
      * Ресурсы
        * *Сумма* (тип: *число(12,2)*)- будет всегда в любой задаче
          * Выставляем *Признак учёта субконто* - *Суммовой*
          * флаг "Балансовый" *должен быть включен*
        * *Количество* (тип: *число(10,0)*)
          * Выставляем *Признак учёта* - *Количественный*
          * флаг "Балансовый" *должен быть выключен*

        ![Регистр бухгалтерии, вкладка "Данные" - "Сумма"](Ticket1/b004_02.png)

        ![Регистр бухгалтерии, вкладка "Данные" - "Количество"](Ticket1/b004_03.png)

    * Вкладка *"Регистраторы"*
      * Добавляем наши документы

    ![Регистр бухгалтерии, вкладка "Регистраторы"](Ticket1/b004_04.png)

  * Создаём документ *"Операция"*
    * Вкладка *"Движения"*
      * Признак *Проведение* - *Запретить*
      * Выбрать наш регистр *Управленческий*

      ![Документ "Операция", вкладка "Движения"](Ticket1/b005_01.png)

    * Создаем форму документа
      * Выводим *Объект* - *Движения* - *Управленческий* - на форму документа

      ![Документ "Операция", форма документа](Ticket1/b005_02.png)
